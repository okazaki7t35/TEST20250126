// 言語切り替え機能
export const translations = {
    ja: {
        // ナビゲーション
        home: 'ホーム',
        menu: 'お品書き',
        info: '店舗情報',
        news: 'お知らせ',
        access: 'アクセス',
        coupon: 'クーポン',
        address: '栃木県大田原市1-10-2',
        phone: '電話：',
        hours: '営業時間：',
        hoursDetail: '月～土：11:00～14:00 / 18:00～21:30',
        closed: '日曜・祝日：休業',
        callButton: 'お電話でのご予約はこちら',
        slide1Title: '伝統の味を守り続けて100年',
        slide1Text: '大田原が誇る老舗そば屋',
        slide2Title: '手打ちそばの真髄',
        slide2Text: '丹念に打ち上げる極上の一杯',
        slide3Title: '自慢のうな重',
        slide3Text: '秘伝のタレで仕上げる極上の味わい',
        // メニューページの翻訳
        menu_intro: '創業100年の伝統の味をご堪能ください',
        menu_soba_udon: 'そば・うどん',
        menu_mori: 'もりそば',
        menu_mori_desc: '季節の薬味と共に',
        menu_zaru: 'ざるそば',
        menu_zaru_desc: '風味豊かな蕎麦の香り',
        menu_kake: 'かけそば',
        menu_kake_desc: '温かい出汁でお召し上がりください',
        menu_ebi_ten: '海老天丼セット',
        menu_ebi_ten_desc: 'そば/うどん選べます',
        menu_kakiage: 'かき揚げ丼セット',
        menu_kakiage_desc: 'そば/うどん選べます',
        menu_lunch: 'サービスランチ',
        menu_lunch_desc: '天ぷら、そば/うどん、半ライス、お新香付き',
        menu_unaju: 'うな重',
        menu_unaju_desc: '秘伝のタレで仕上げた自慢の一品',
        menu_tempura: '天ぷら定食',
        menu_tempura_desc: 'サクサクの天ぷらと共に',
        menu_tendon: '天丼',
        menu_tendon_desc: 'ボリューム満点の天ぷらをのせて',
        // クーポン関連の翻訳
        couponValidity: '有効期限：2025年2月1日～2月29日',
        couponDiscount: '全品100円引き',
        couponInstruction: 'ご注文時にスタッフへ画面をご提示ください',
        couponTerm1: '1会計につき1回限り有効',
        couponTerm2: '他のサービス券との併用不可',
        couponTerm3: 'ランチタイムにもご利用いただけます',
        couponStep1: 'ご注文時にスタッフへクーポン画面をご提示ください',
        couponStep2: 'スタッフが画面を確認させていただきます',
        couponStep3: '会計時に100円引きいたします',
        couponNote1: 'クーポンは1会計につき1回限り有効です',
        couponNote2: '他のサービス券やキャンペーンとの併用はできません',
        couponNote3: 'クーポンの内容は予告なく変更される場合があります',
        couponNote4: 'スクリーンショットでのご利用も可能です',
        couponNote5: 'クーポンの転用や複製は固くお断りいたします',
        nextCouponInfo1: '3月のクーポンは2月下旬に公開予定です',
        nextCouponInfo2: 'お楽しみに！',
        // お知らせセクション
        notice1Title: '営業時間変更のお知らせ',
        notice1Text: '2月末まで、夜の営業時間を21:00までに変更させていただきます。',
        notice2Title: '季節の限定メニュー登場',
        notice2Text: '春の訪れを感じる桜海老のかき揚げそばを期間限定で提供いたします。',
        // 店舗情報セクション
        businessHours: '【営業時間】',
        weekdayHours: '月～土：11:00～14:00 / 18:00～21:30',
        reservationNote: '※ご予約がない場合20:00閉店',
        holidayHours: '日曜・祝日：休業',
        reservationContact: '【ご予約・お問い合わせ】',
        reservationPhoneOnly: '※ご予約は電話のみ承ります（日本語対応）',
        facilitiesServices: '【設備・サービス】',
        parking: '駐車場：10台（無料）',
        smoking: '喫煙：可',
        seating: '座席：テーブル席・座敷',
        privateRoom: '個室：あり（要予約）',
        takeout: 'テイクアウト：可（電話注文）'
    },
    en: {
        home: 'Home',
        menu: 'Menu',
        info: 'Information',
        news: 'News',
        access: 'Access',
        coupon: 'Coupon',
        address: '1-10-2, Otawara City, Tochigi Prefecture',
        phone: 'Tel: ',
        hours: 'Business Hours:',
        hoursDetail: 'Mon-Sat: 11:00-14:00 / 18:00-21:30',
        closed: 'Closed: Sundays & Holidays',
        callButton: 'Call for Reservation',
        slide1Title: '100 Years of Traditional Taste',
        slide1Text: 'A historic soba restaurant in Otawara',
        slide2Title: 'The Art of Handmade Soba',
        slide2Text: 'Carefully crafted noodles for the perfect bowl',
        slide3Title: 'Special Grilled Eel',
        slide3Text: 'Perfectly grilled with our secret sauce',
        // Menu page translations
        menu_intro: 'Enjoy our traditional taste, cultivated over 100 years',
        menu_soba_udon: 'Soba & Udon',
        menu_mori: 'Mori Soba',
        menu_mori_desc: 'Served with seasonal condiments',
        menu_zaru: 'Zaru Soba',
        menu_zaru_desc: 'With rich soba aroma',
        menu_kake: 'Kake Soba',
        menu_kake_desc: 'Served with hot broth',
        menu_ebi_ten: 'Tempura Shrimp Bowl Set',
        menu_ebi_ten_desc: 'Choice of soba or udon noodles',
        menu_kakiage: 'Mixed Tempura Bowl Set',
        menu_kakiage_desc: 'Choice of soba or udon noodles',
        menu_lunch: 'Service Lunch',
        menu_lunch_desc: 'Includes tempura, noodles, rice, and pickles',
        menu_unaju: 'Grilled Eel Bowl',
        menu_unaju_desc: 'Our signature dish with special sauce',
        menu_tempura: 'Tempura Set',
        menu_tempura_desc: 'Crispy tempura selection',
        menu_tendon: 'Tempura Bowl',
        menu_tendon_desc: 'Generous serving of tempura on rice',
        // Coupon translations
        couponValidity: 'Valid: February 1-29, 2025',
        couponDiscount: '¥100 OFF All Items',
        couponInstruction: 'Please show this screen to our staff when ordering',
        couponTerm1: 'Valid once per transaction',
        couponTerm2: 'Cannot be combined with other offers',
        couponTerm3: 'Valid during lunch hours',
        couponStep1: 'Show this coupon screen to our staff when ordering',
        couponStep2: 'Staff will verify the coupon',
        couponStep3: '¥100 will be discounted at checkout',
        couponNote1: 'Coupon is valid once per transaction',
        couponNote2: 'Cannot be combined with other promotions or discounts',
        couponNote3: 'Coupon terms may change without notice',
        couponNote4: 'Screenshots are accepted',
        couponNote5: 'Reproduction or transfer of coupons is strictly prohibited',
        nextCouponInfo1: 'March coupons will be available in late February',
        nextCouponInfo2: 'Stay tuned!',
        // News section
        notice1Title: 'Changes in Business Hours',
        notice1Text: 'Evening business hours will be changed to 21:00 until the end of February.',
        notice2Title: 'Seasonal Special Menu',
        notice2Text: 'Limited time offer: Sakura shrimp tempura soba, a taste of spring.',
        // Information section
        businessHours: '【Business Hours】',
        weekdayHours: 'Mon-Sat: 11:00-14:00 / 18:00-21:30',
        reservationNote: '*Closes at 20:00 without reservations',
        holidayHours: 'Closed: Sundays & Holidays',
        reservationContact: '【Reservations & Inquiries】',
        reservationPhoneOnly: '*Phone reservations only (Japanese available)',
        facilitiesServices: '【Facilities & Services】',
        parking: 'Parking: 10 spaces (Free)',
        smoking: 'Smoking: Allowed',
        seating: 'Seating: Tables & Tatami rooms',
        privateRoom: 'Private room: Available (Reservation required)',
        takeout: 'Takeout: Available (Phone orders)'
    },
    zh: {
        home: '首页',
        menu: '菜单',
        info: '店铺信息',
        news: '新闻',
        access: '位置',
        coupon: '优惠券',
        address: '枥木县大田原市1-10-2',
        phone: '电话：',
        hours: '营业时间：',
        hoursDetail: '周一至周六：11:00～14:00 / 18:00～21:30',
        closed: '周日及节假日休息',
        callButton: '电话预约',
        slide1Title: '传承百年之味',
        slide1Text: '大田原引以为傲的传统荞麦面店',
        slide2Title: '手工荞麦面的精髓',
        slide2Text: '精心制作的极品面条',
        slide3Title: '招牌鳗鱼饭',
        slide3Text: '秘制酱汁烤制的顶级美味',
        // 菜单页面翻译
        menu_intro: '百年传统的美味佳肴',
        menu_soba_udon: '荞麦面・乌冬面',
        menu_mori: '荞麦冷面',
        menu_mori_desc: '配以时令调味料',
        menu_zaru: '笊篱荞麦面',
        menu_zaru_desc: '浓郁荞麦香气',
        menu_kake: '热汤荞麦面',
        menu_kake_desc: '搭配温暖汤汁',
        menu_ebi_ten: '天妇罗虾盖饭套餐',
        menu_ebi_ten_desc: '可选择荞麦面或乌冬面',
        menu_kakiage: '什锦天妇罗盖饭套餐',
        menu_kakiage_desc: '可选择荞麦面或乌冬面',
        menu_lunch: '午市套餐',
        menu_lunch_desc: '包含天妇罗、面条、米饭和咸菜',
        menu_unaju: '鳗鱼饭',
        menu_unaju_desc: '秘制酱汁烤制的招牌美味',
        menu_tempura: '天妇罗定食',
        menu_tempura_desc: '香脆可口的天妇罗',
        menu_tendon: '天妇罗盖饭',
        menu_tendon_desc: '满满的天妇罗配上香喷喷的米饭',
        // 优惠券相关翻译
        couponValidity: '有效期：2025年2月1日至2月29日',
        couponDiscount: '全品优惠100日元',
        couponInstruction: '点餐时请向店员出示此画面',
        couponTerm1: '每笔交易限用一次',
        couponTerm2: '不可与其他优惠同时使用',
        couponTerm3: '午市时段同样有效',
        couponStep1: '点餐时请向店员出示优惠券画面',
        couponStep2: '店员将确认优惠券',
        couponStep3: '结账时将优惠100日元',
        couponNote1: '优惠券每笔交易限用一次',
        couponNote2: '不可与其他优惠活动或折扣同时使用',
        couponNote3: '优惠券内容可能会随时变更',
        couponNote4: '可使用截图',
        couponNote5: '严禁复制或转让优惠券',
        nextCouponInfo1: '3月优惠券将于2月下旬公布',
        nextCouponInfo2: '敬请期待！',
        // 新闻部分
        notice1Title: '营业时间变更通知',
        notice1Text: '到2月底为止，晚间营业时间将调整至21:00',
        notice2Title: '季节限定菜单上新',
        notice2Text: '限时供应：樱花虾天妇罗荞麦面，品味春天的气息',
        // 店铺信息部分
        businessHours: '【营业时间】',
        weekdayHours: '周一至周六：11:00～14:00 / 18:00～21:30',
        reservationNote: '*无预约时20:00结束营业',
        holidayHours: '周日及节假日休息',
        reservationContact: '【预约咨询】',
        reservationPhoneOnly: '*仅接受电话预约（提供日语服务）',
        facilitiesServices: '【设施服务】',
        parking: '停车场：10个车位（免费）',
        smoking: '吸烟：可以',
        seating: '座位：桌席・榻榻米',
        privateRoom: '包间：可用（需预约）',
        takeout: '外带：可以（电话订餐）'
    }
};

export async function initLanguageSwitcher() {
    console.log('Initializing language switcher...');

    // 言語切り替えボタンを取得
    const languageSwitcher = document.querySelector('.language-switcher');
    if (!languageSwitcher) {
        console.error('Language switcher container not found');
        return;
    }

    // 直接クリックイベントをコンテナに設定（イベント委譲）
    languageSwitcher.addEventListener('click', async (event) => {
        const button = event.target.closest('button');
        if (!button) return;

        const lang = button.dataset.lang;
        if (!lang || !translations[lang]) {
            console.error(`Invalid language selected: ${lang}`);
            return;
        }

        console.log(`Language button clicked: ${lang}`);
        event.preventDefault();
        event.stopPropagation();

        try {
            // DOMを更新
            document.documentElement.lang = lang;
            console.log(`Set HTML lang attribute to: ${lang}`);

            // テキストの翻訳を実行
            const elements = document.querySelectorAll('[data-translate]');
            console.log(`Found ${elements.length} translatable elements`);

            elements.forEach(element => {
                const key = element.dataset.translate;
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                    console.log(`Updated element with key "${key}" to: ${translations[lang][key]}`);
                } else {
                    console.warn(`Translation key "${key}" not found for language "${lang}"`);
                }
            });

            // ボタンの状態を更新
            document.querySelectorAll('.language-switcher button').forEach(btn => {
                const isActive = btn.dataset.lang === lang;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-pressed', isActive.toString());
                console.log(`Updated button state for ${btn.dataset.lang}: ${isActive}`);
            });

            // ローカルストレージに保存
            localStorage.setItem('preferred-language', lang);
            console.log(`Language preference saved: ${lang}`);

            // カスタムイベントを発火
            window.dispatchEvent(new CustomEvent('languageChanged', {
                detail: { language: lang }
            }));

        } catch (error) {
            console.error('Error changing language:', error);
        }
    });

    // 初期言語の設定
    try {
        const savedLang = localStorage.getItem('preferred-language');
        const initialLang = (savedLang && translations[savedLang]) ? savedLang : 'ja';
        document.documentElement.lang = initialLang;
        
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(element => {
            const key = element.dataset.translate;
            if (translations[initialLang][key]) {
                element.textContent = translations[initialLang][key];
            }
        });

        document.querySelectorAll('.language-switcher button').forEach(btn => {
            const isActive = btn.dataset.lang === initialLang;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-pressed', isActive.toString());
        });

        console.log(`Initial language set to: ${initialLang}`);
    } catch (error) {
        console.error('Error setting initial language:', error);
    }

    console.log('Language switcher initialization complete');
}