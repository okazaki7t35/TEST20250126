// 言語切り替え機能
export const translations = {
    ja: {
        home: 'ホーム',
        menu: 'お品書き',
        info: '店舗情報',
        news: 'お知らせ',
        access: 'アクセス',
        coupon: 'クーポン',
        address: '栃木県大田原市1-10-2',
        phone: '電話：',
        hours: '営業時間：',
        hoursDetail: '月～土：11:00～14:00 / 18:00～21:30',
        closed: '日曜・祝日：休業',
        callButton: 'お電話でのご予約はこちら',
        slide1Title: '伝統の味を守り続けて100年',
        slide1Text: '大田原が誇る老舗そば屋',
        slide2Title: '手打ちそばの真髄',
        slide2Text: '丹念に打ち上げる極上の一杯',
        slide3Title: '自慢のうな重',
        slide3Text: '秘伝のタレで仕上げる極上の味わい',
        // メニューページの翻訳
        menu_intro: '創業100年の伝統の味をご堪能ください',
        menu_soba_udon: 'そば・うどん',
        menu_mori: 'もりそば',
        menu_mori_desc: '季節の薬味と共に',
        menu_zaru: 'ざるそば',
        menu_zaru_desc: '風味豊かな蕎麦の香り',
        menu_kake: 'かけそば',
        menu_kake_desc: '温かい出汁でお召し上がりください',
        menu_ebi_ten: '海老天丼セット',
        menu_ebi_ten_desc: 'そば/うどん選べます',
        menu_kakiage: 'かき揚げ丼セット',
        menu_kakiage_desc: 'そば/うどん選べます',
        menu_lunch: 'サービスランチ',
        menu_lunch_desc: '天ぷら、そば/うどん、半ライス、お新香付き',
        menu_unaju: 'うな重',
        menu_unaju_desc: '秘伝のタレで仕上げた自慢の一品',
        menu_tempura: '天ぷら定食',
        menu_tempura_desc: 'サクサクの天ぷらと共に',
        menu_tendon: '天丼',
        menu_tendon_desc: 'ボリューム満点の天ぷらをのせて'
    },
    en: {
        home: 'Home',
        menu: 'Menu',
        info: 'Information',
        news: 'News',
        access: 'Access',
        coupon: 'Coupon',
        address: '1-10-2, Otawara City, Tochigi Prefecture',
        phone: 'Tel: ',
        hours: 'Business Hours:',
        hoursDetail: 'Mon-Sat: 11:00-14:00 / 18:00-21:30',
        closed: 'Closed: Sundays & Holidays',
        callButton: 'Call for Reservation',
        slide1Title: '100 Years of Traditional Taste',
        slide1Text: 'A historic soba restaurant in Otawara',
        slide2Title: 'The Art of Handmade Soba',
        slide2Text: 'Carefully crafted noodles for the perfect bowl',
        slide3Title: 'Special Grilled Eel',
        slide3Text: 'Perfectly grilled with our secret sauce',
        // Menu page translations
        menu_intro: 'Enjoy our traditional taste, cultivated over 100 years',
        menu_soba_udon: 'Soba & Udon',
        menu_mori: 'Mori Soba',
        menu_mori_desc: 'Served with seasonal condiments',
        menu_zaru: 'Zaru Soba',
        menu_zaru_desc: 'With rich soba aroma',
        menu_kake: 'Kake Soba',
        menu_kake_desc: 'Served with hot broth',
        menu_ebi_ten: 'Tempura Shrimp Bowl Set',
        menu_ebi_ten_desc: 'Choice of soba or udon noodles',
        menu_kakiage: 'Mixed Tempura Bowl Set',
        menu_kakiage_desc: 'Choice of soba or udon noodles',
        menu_lunch: 'Service Lunch',
        menu_lunch_desc: 'Includes tempura, noodles, rice, and pickles',
        menu_unaju: 'Grilled Eel Bowl',
        menu_unaju_desc: 'Our signature dish with special sauce',
        menu_tempura: 'Tempura Set',
        menu_tempura_desc: 'Crispy tempura selection',
        menu_tendon: 'Tempura Bowl',
        menu_tendon_desc: 'Generous serving of tempura on rice'
    },
    zh: {
        home: '首页',
        menu: '菜单',
        info: '店铺信息',
        news: '新闻',
        access: '位置',
        coupon: '优惠券',
        address: '枥木县大田原市1-10-2',
        phone: '电话：',
        hours: '营业时间：',
        hoursDetail: '周一至周六：11:00～14:00 / 18:00～21:30',
        closed: '周日及节假日休息',
        callButton: '电话预约',
        slide1Title: '传承百年之味',
        slide1Text: '大田原引以为傲的传统荞麦面店',
        slide2Title: '手工荞麦面的精髓',
        slide2Text: '精心制作的极品面条',
        slide3Title: '招牌鳗鱼饭',
        slide3Text: '秘制酱汁烤制的顶级美味',
        // 菜单页面翻译
        menu_intro: '百年传统的美味佳肴',
        menu_soba_udon: '荞麦面・乌冬面',
        menu_mori: '荞麦冷面',
        menu_mori_desc: '配以时令调味料',
        menu_zaru: '笊篱荞麦面',
        menu_zaru_desc: '浓郁荞麦香气',
        menu_kake: '热汤荞麦面',
        menu_kake_desc: '搭配温暖汤汁',
        menu_ebi_ten: '天妇罗虾盖饭套餐',
        menu_ebi_ten_desc: '可选择荞麦面或乌冬面',
        menu_kakiage: '什锦天妇罗盖饭套餐',
        menu_kakiage_desc: '可选择荞麦面或乌冬面',
        menu_lunch: '午市套餐',
        menu_lunch_desc: '包含天妇罗、面条、米饭和咸菜',
        menu_unaju: '鳗鱼饭',
        menu_unaju_desc: '秘制酱汁烤制的招牌美味',
        menu_tempura: '天妇罗定食',
        menu_tempura_desc: '香脆可口的天妇罗',
        menu_tendon: '天妇罗盖饭',
        menu_tendon_desc: '满满的天妇罗配上香喷喷的米饭'
    }
};

export async function initLanguageSwitcher() {
    console.log('Initializing language switcher...');

    // 言語切り替えボタンを取得
    const languageSwitcher = document.querySelector('.language-switcher');
    if (!languageSwitcher) {
        console.error('Language switcher container not found');
        return;
    }

    // 直接クリックイベントをコンテナに設定（イベント委譲）
    languageSwitcher.addEventListener('click', async (event) => {
        const button = event.target.closest('button');
        if (!button) return;

        const lang = button.dataset.lang;
        if (!lang || !translations[lang]) {
            console.error(`Invalid language selected: ${lang}`);
            return;
        }

        console.log(`Language button clicked: ${lang}`);
        event.preventDefault();
        event.stopPropagation();

        try {
            // DOMを更新
            document.documentElement.lang = lang;
            console.log(`Set HTML lang attribute to: ${lang}`);

            // テキストの翻訳を実行
            const elements = document.querySelectorAll('[data-translate]');
            console.log(`Found ${elements.length} translatable elements`);

            elements.forEach(element => {
                const key = element.dataset.translate;
                if (translations[lang][key]) {
                    element.textContent = translations[lang][key];
                    console.log(`Updated element with key "${key}" to: ${translations[lang][key]}`);
                } else {
                    console.warn(`Translation key "${key}" not found for language "${lang}"`);
                }
            });

            // ボタンの状態を更新
            document.querySelectorAll('.language-switcher button').forEach(btn => {
                const isActive = btn.dataset.lang === lang;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-pressed', isActive.toString());
                console.log(`Updated button state for ${btn.dataset.lang}: ${isActive}`);
            });

            // ローカルストレージに保存
            localStorage.setItem('preferred-language', lang);
            console.log(`Language preference saved: ${lang}`);

            // カスタムイベントを発火
            window.dispatchEvent(new CustomEvent('languageChanged', {
                detail: { language: lang }
            }));

        } catch (error) {
            console.error('Error changing language:', error);
        }
    });

    // 初期言語の設定
    try {
        const savedLang = localStorage.getItem('preferred-language');
        const initialLang = (savedLang && translations[savedLang]) ? savedLang : 'ja';
        document.documentElement.lang = initialLang;
        
        const elements = document.querySelectorAll('[data-translate]');
        elements.forEach(element => {
            const key = element.dataset.translate;
            if (translations[initialLang][key]) {
                element.textContent = translations[initialLang][key];
            }
        });

        document.querySelectorAll('.language-switcher button').forEach(btn => {
            const isActive = btn.dataset.lang === initialLang;
            btn.classList.toggle('active', isActive);
            btn.setAttribute('aria-pressed', isActive.toString());
        });

        console.log(`Initial language set to: ${initialLang}`);
    } catch (error) {
        console.error('Error setting initial language:', error);
    }

    console.log('Language switcher initialization complete');
}